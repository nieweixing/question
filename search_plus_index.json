{"./":{"url":"./","title":"简介","keywords":"","body":"简介 本书主要记录了个人运维过程中遇到的各种问题，希望这些笔记在大家学习的过程能帮到大家，相关笔记后续会逐步完善。 © vishon all right reserved，powered by GitbookUpdated at 2021-09-22 14:41:34 "},"tke/Pod-uses-components-to-mount-cfs-to-report-errors.html":{"url":"tke/Pod-uses-components-to-mount-cfs-to-report-errors.html","title":"1.pod采用组件挂载cfs报错","keywords":"","body":"pod采用组件挂载cfs报错 问题现象 pod通过cfs组件挂载cfs一直pending，pod起不来，查看事件报错MountVolume.MountDevice failed for volume \"xxxxxxx\" : kubernetes.io/csi: attacher.MountDevice failed to create newCsiDriverClient: driver name com.tencent.cloud.csi.cfs not found in the list of registered CSI drivers。 排查思路 根据事件日志报错是因为cfs组件agent异常导致，检查cfs组件的agent是正常运行。 查看事件发现有一条日志Starting pod sandbox eks-xxxxx，这个说明是调度到虚拟节点的，但是cfs组件的agent是csi-nodeplugin-cfsplugin(kube-system)，这个负载是DaemonSet类型，虚拟节点是无法运行DaemonSet，所以组件的agent无法在虚拟节点上运行。导致pod挂载cfs异常。 解决方案 将pod调度到正常节点上，不要调度到虚拟节点上，或者采用nfs的方式进行挂载。 © vishon all right reserved，powered by GitbookUpdated at 2021-10-20 23:34:42 "},"k8s/The-hosts-configuration-in-coredns-cannot-be-correctly-parsed-in-pods-in-the-k8s-cluster.html":{"url":"k8s/The-hosts-configuration-in-coredns-cannot-be-correctly-parsed-in-pods-in-the-k8s-cluster.html","title":"1.k8s集群内pod内无法正确解析coredns中的hosts配置","keywords":"","body":"k8s集群内pod内无法正确解析coredns中的hosts配置 问题现象 k8s的coredns中进行了hosts的全局域名解析配置，但是在容器内解析对应的域名发现走的是k8s集群内部的svc.cluster.local域名，并没有解析到配置的hosts上 排查思路 这边首先测试了下在节点上配置了hosts是能正常解析，并且将pod的dns策略改成default不走coredns也是能正常解析，那么为什么经过coredns就不行了呢？这里看了下coredns中配置hosts的方式也没有问题。 这里查看了下coredns的官方文档hosts配置https://coredns.io/plugins/hosts/#description，发现我配置的hosts插件中没有设置fallthrough这个字段，根据文档的说明 fallthrough If zone matches and no record can be generated, pass request to the next plugin. If [ZONES…] is omitted, then fallthrough happens for all zones for which the plugin is authoritative. If specific zones are listed (for example and ), then only queries for those zones will be subject to fallthrough.in-addr.arpaip6.arpa 如果区域匹配并且无法生成记录，fallthrough则将请求传递给下一个插件，如果不设置，则不会继续找其他插件进行解析。 If you want to pass the request to the rest of the plugin chain if there is no match in the hosts plugin, you must specify the option.fallthrough 如果在hosts插件中没有匹配项的情况下要将请求传递给插件链的其余部分，则必须指定fallthrough，所以这里大概就是fallthrough没有设置导致的。 解决方案 coredns的hosts插件中加上fallthrough配置，然后重建coredns的pod即可。 © vishon all right reserved，powered by GitbookUpdated at 2021-10-20 23:55:31 "}}